/*********************************************************
*Class        :  ABHI_CreateCRMPolicy_Test
*Author       :  Aditee Churiwala 
*Created Date :  12/08/2024
*Last Modified:  12/08/2024
*@description  : Test class for ABHI_CreateCRMPolicy_Test
*********************************************************/
@isTest 
private class ABHI_CreateCRMPolicy_Test {
	/****************************************************************************************************
    * @Function - createRequest
    * @param body - String body to be used
    * description  - Method to create rest request for the test methods
    *****************************************************************************************************/
     @isTest 
     static void testPostMethod(){
        Test.startTest();
      
        String masterPolicy = '{\"Customer\":[{\"AadharNo\":\"\",\"AddressLine1\":\"SAINIADARSHVIDYAMANDIRKEPICHEWARDNO-22\",\"AddressLine2\":\"BANDIKUIDIST-DAUSA\",\"AddressLine3\":null,\"AddressType\":\"Permanent\",\"PIN\":\"303313\",\"City\":\"Bandikui\",\"State\":\"RAJASTHAN\",\"Email\":\"khandelwalashok39@Gmail.com\",\"HomePhone\":null,\"Alternatemobile\":\"7014903221\",\"CoreSystemId\":\"ABC-PT86390848-01\",\"CountryCode\":\"India\",\"DateofBirth\":\"1978-09-03\",\"Designation\":\"SelfEmployed\",\"EmployeeCode\":null,\"FirstName\":\"ASOK\",\"FullName\":\"BajajFinanceLtd.\",\"Gender\":\"Male\",\"LastName\":\"\",\"HealthCardNumber\":\"\",\"Height\":\"\",\"Weight\":\"\",\"MaritualStatus\":\"\",\"MobilePhone\":\"9413278032\",\"Nationality\":\"\",\"Nationality1\":\"\",\"PanNo\":\"XGZPE7225A\",\"ParentCode\":null,\"WhatsappNumber\":\"\",\"CustomerSegments\":[{\"Segment\":\"HNI\"}],\"CustomerRoles\":[{\"CustomerType\":\"RetailCustomer\"},{\"CustomerType\":\"DependentCustomer\"}]}],\"CustomerMemberMapping\":[],\"NomineeDetails\":[],\"Policy\":{\"AgentStatus\":null,\"ARU\":\"STP\",\"ActiveHealthVersion\":\"V4\",\"ApplicationDate\":\"2024-07-31\",\"ProposalNumber\":\"ABC-240000725585-01\",\"AutoDebitFlag\":null,\"AutoDebitRegistrationStatus\":null,\"BalanceHR\":null,\"BasicPremium\":\"18555.98\",\"BusinessType\":\"Renewal\",\"Channel\":\"ABHI\",\"COILink\":null,\"CountOfLives\":\"4\",\"CombiPolicyNo\":null,\"CombiPolicyType\":\"No\",\"ConsumedHR\":null,\"CrossSellNumber\":null,\"DRMCustomer\":\"No\",\"DebitFrequency\":null,\"DebitReason\":null,\"Discount\":null,\"FamilyType\":\"\",\"FamilyDefinition\":\"\",\"GoGreen\":\"No\",\"GrossPremium\":\"21896.0\",\"HA\":null,\"HHS\":null,\"CustomerSegment\":null,\"HR\":null,\"IntermediaryCode\":\"ABH1171726\",\"IntermediaryEmailId\":\"MAKANINSURANCE@GMAIL.COM\",\"IntermediaryMobileNumber\":\"9610455091\",\"IntermediaryName\":\"Renu\\r\\nGera\",\"LeadId\":\"LEAD-104331148\",\"MandateEndDate\":null,\"MandateStartDate\":null,\"MasterPolicy\":null,\"MasterPolicyNumber\":null,\"MaturityDate\":\"2025-07-30\",\"Mode\":\"Cheque\",\"NameOfEW\":null,\"NetPremium\":\"\",\"NextPremiumDate\":\"\",\"OwnerClientCode\":\"ABC-PT86390848-01\",\"PaymentStatus\":\"Paidout\",\"PlanName\":\"Platinum-Enhanced\",\"PolicyCancellationReason\":null,\"PolicyIssueDate\":\"2024-07-31\",\"PolicyNumber\":\"ABC-71-21-00036-01-02\",\"PolicyStatus\":\"IF\",\"PolicySubStatus\":null,\"PolicyTerm\":\"1Year\",\"PolicyType\":\"Group\",\"PolicySubType\":\"Policy\",\"PortalCertificate\":null,\"ProductName\":\"ActivHealthV2\",\"ProposalType\":\"STP\",\"RejectionReason\":null,\"SNCB\":null,\"SalesManagerEmail\":null,\"SalesManagerMobile\":\"9461681126\",\"SalesRelationshipManagerCode\":\"570761\",\"SalesRelationshipManagerName\":\"RajniArora\",\"SandboxPolicy\":\"No\",\"ServicingBranchName\":\"Jaipur2\",\"Source\":\"SellerPortal\",\"TAXDetails\":\"3340.08\",\"TPA\":null,\"TPAContactDetails\":null,\"TotalSumInsured\":\"500000\",\"UR\":null,\"UWLoading\":\"0\",\"ZoneOfCover\":\"ZoneIII\",\"TotalHR\":null,\"UtilizedHR\":null,\"SponsoredFlag\":\"No\",\"RenewableFlag\":\"NO\",\"PreviousPolicyNumber\":null}}';
       	createRequest(masterPolicy);
        
        String retailPolicy = '{\"Customer\":[{\"AadharNo\":null,\"AddressLine1\":\"250/13NearSatJindaKalayanaMandirChottaPanna,Kalanaur\",\"AddressLine2\":\"NA\",\"AddressLine3\":null,\"AddressType\":\"Permanent\",\"PIN\":\"124113\",\"City\":\"Rohtak\",\"State\":\"HARYANA\",\"Email\":\"ab@xyz.com\",\"HomePhone\":null,\"Alternatemobile\":\"9999999999\",\"CoreSystemId\":\"13882784-01\",\"CountryCode\":\"India\",\"DateofBirth\":\"1995-10-21\",\"Designation\":\"Others\",\"EmployeeCode\":\"75226810\",\"FirstName\":\"MrParas\",\"FullName\":\"MrParas.\",\"Gender\":\"Male\",\"LastName\":\".\",\"HealthCardNumber\":\"6051092413469349\",\"Height\":\"0\",\"Weight\":\"0\",\"MaritualStatus\":null,\"MobilePhone\":\"9999999999\",\"Nationality\":\"Indian\",\"Nationality1\":\"India\",\"PanNo\":\"AACCE9326L\",\"ParentCode\":null,\"WhatsappNumber\":\"YES\",\"CustomerSegments\":[{\"Segment\":\"HNI\"}],\"CustomerRoles\":[{\"CustomerType\":\"MemberCustomer\"},{\"CustomerType\":\"DependentCustomer\"}]}],\"CustomerMemberMapping\":[{\"ClientId\":\"13882784-01\",\"MemberId\":\"13882784-01\",\"MemberStatus\":\"Active\",\"MemberSubStatus\":null,\"PreExistingDiseaseWaitingPeriod\":null,\"TotalNCB\":\"0\",\"RidersOpted\":null,\"SumInsured\":\"9500000\",\"UpfrontDiscount\":\"No\"}],\"NomineeDetails\":[{\"Gender\":null,\"NomineeContactNumber\":\"9999999999\",\"NomineeDOB\":null,\"NomineeName\":\"RoshanLal\",\"NomineePercentage\":\"100\",\"Relationship\":\"Father\"}],\"Policy\":{\"AgentStatus\":null,\"ARU\":\"STP\",\"ActiveHealthVersion\":null,\"ApplicationDate\":\"2024-07-29\",\"ProposalNumber\":\"QU-23-5211-8454629-00-01\",\"AutoDebitFlag\":null,\"AutoDebitRegistrationStatus\":null,\"BalanceHR\":null,\"BasicPremium\":\"4650.0\",\"BusinessType\":\"Renewal\",\"Channel\":\"ABHI\",\"COILink\":null,\"CountOfLives\":\"1\",\"CombiPolicyNo\":null,\"CombiPolicyType\":\"No\",\"ConsumedHR\":null,\"CrossSellNumber\":null,\"DRMCustomer\":\"No\",\"DebitFrequency\":null,\"DebitReason\":null,\"Discount\":null,\"FamilyType\":null,\"FamilyDefinition\":null,\"GoGreen\":\"Yes\",\"GrossPremium\":\"5487.0\",\"HA\":null,\"HHS\":null,\"CustomerSegment\":null,\"HR\":null,\"IntermediaryCode\":\"5100357\",\"IntermediaryEmailId\":\"crthealth@policybazaar.com\",\"IntermediaryMobileNumber\":\"18002585970\",\"IntermediaryName\":\"POLICYBAZAARINSURANCEBROKERSPRIVATELIMITED\",\"LeadId\":null,\"MandateEndDate\":null,\"MandateStartDate\":null,\"MasterPolicy\":null,\"MasterPolicyNumber\":\"ABC-71-21-00036-01-02\",\"MaturityDate\":\"2025-07-28\",\"Mode\":\"OnlinePayment\",\"NameOfEW\":null,\"NetPremium\":\"4650.0\",\"NextPremiumDate\":\"2025-07-29\",\"OwnerClientCode\":\"13882784-01\",\"PaymentStatus\":\"Raisedandpaid\",\"PlanName\":\"GroupActivHealthv2\",\"PolicyCancellationReason\":null,\"PolicyIssueDate\":\"2024-07-29\",\"PolicyNumber\":\"GHI-HB-22-2007426-007-01\",\"PolicyStatus\":\"IF\",\"PolicySubStatus\":null,\"PolicyTerm\":\"1Year\",\"PolicyType\":\"Affinity\",\"PolicySubType\":\"Certificate\",\"PortalCertificate\":null,\"ProductName\":\"GroupActivHealthV2\",\"ProposalType\":\"STP\",\"RejectionReason\":null,\"SNCB\":null,\"SalesManagerEmail\":null,\"SalesManagerMobile\":\"9899937413\",\"SalesRelationshipManagerCode\":\"417457\",\"SalesRelationshipManagerName\":\"NaveenSehrawat\",\"SandboxPolicy\":\"No\",\"ServicingBranchName\":\"HeadOffice\",\"Source\":\"TCSBaNCS\",\"TAXDetails\":\"837.0\",\"TPA\":null,\"TPAContactDetails\":null,\"TotalSumInsured\":\"9500000\",\"UR\":null,\"UWLoading\":\"0\",\"ZoneOfCover\":\"ZoneIII\",\"TotalHR\":null,\"UtilizedHR\":null,\"SponsoredFlag\":\"No\",\"RenewableFlag\":\"YES\",\"PreviousPolicyNumber\":null}}';
        String response = createRequest(retailPolicy);

        Test.stopTest();
        ABHI_ResponseWrapper responseBody = (ABHI_ResponseWrapper) JSON.deserialize(response, ABHI_ResponseWrapper.class);
        Assert.areEqual('200', responseBody.StatusCode);
        Assert.areEqual('Success', responseBody.StatusMessage);
    }
    /****************************************************************************************************
    * @Function - testExceptionMethod
    * @param body 
    * description  - Test Exception
    *****************************************************************************************************/
    @isTest 
     static void testExceptionMethod(){
        Test.startTest();
      
        String retailPolicy = '{\"Customer\":[{\"AadharNo\":null,\"AddressLine1\":\"250/13NearSatJindaKalayanaMandirChottaPanna,Kalanaur\",\"AddressLine2\":\"NA\",\"AddressLine3\":null,\"AddressType\":\"Permanent\",\"PIN\":\"124113\",\"City\":\"Rohtak\",\"State\":\"HARYANA\",\"Email\":\"ab@xyz.com\",\"HomePhone\":null,\"Alternatemobile\":\"9999999999\",\"CoreSystemId\":\"13882784-01\",\"CountryCode\":\"India\",\"DateofBirth\":\"1995-10-21\",\"Designation\":\"Others\",\"EmployeeCode\":\"75226810\",\"FirstName\":\"MrParas\",\"FullName\":\"MrParas.\",\"Gender\":\"Male\",\"LastName\":\".\",\"HealthCardNumber\":\"6051092413469349\",\"Height\":\"0\",\"Weight\":\"0\",\"MaritualStatus\":null,\"MobilePhone\":\"9999999999\",\"Nationality\":\"Indian\",\"Nationality1\":\"India\",\"PanNo\":\"AACCE9326L\",\"ParentCode\":null,\"WhatsappNumber\":\"YES\",\"CustomerSegments\":[{\"Segment\":\"HNI\"}],\"CustomerRoles\":[{\"CustomerType\":\"MemberCustomer\"},{\"CustomerType\":\"DependentCustomer\"}]}],\"CustomerMemberMapping\":[{\"ClientId\":\"13882784-01\",\"MemberId\":\"13882784-01\",\"MemberStatus\":\"Active\",\"MemberSubStatus\":null,\"PreExistingDiseaseWaitingPeriod\":null,\"TotalNCB\":\"0\",\"RidersOpted\":null,\"SumInsured\":\"9500000\",\"UpfrontDiscount\":\"No\"}],\"NomineeDetails\":[{\"Gender\":null,\"NomineeContactNumber\":\"9999999999\",\"NomineeDOB\":null,\"NomineeName\":\"RoshanLal\",\"NomineePercentage\":\"100\",\"Relationship\":\"Father\"}],\"Policy\":{\"AgentStatus\":null,\"ARU\":\"STP\",\"ActiveHealthVersion\":null,\"ApplicationDate\":\"2024-07-29\",\"ProposalNumber\":\"QU-23-5211-8454629-00-01\",\"AutoDebitFlag\":null,\"AutoDebitRegistrationStatus\":null,\"BalanceHR\":null,\"BasicPremium\":\"4650.0\",\"BusinessType\":\"Renewal\",\"Channel\":\"ABHI\",\"COILink\":null,\"CountOfLives\":\"1\",\"CombiPolicyNo\":null,\"CombiPolicyType\":\"No\",\"ConsumedHR\":null,\"CrossSellNumber\":null,\"DRMCustomer\":\"No\",\"DebitFrequency\":null,\"DebitReason\":null,\"Discount\":null,\"FamilyType\":null,\"FamilyDefinition\":null,\"GoGreen\":\"Yes\",\"GrossPremium\":\"5487.0\",\"HA\":null,\"HHS\":null,\"CustomerSegment\":null,\"HR\":null,\"IntermediaryCode\":\"5100357\",\"IntermediaryEmailId\":\"crthealth@policybazaar.com\",\"IntermediaryMobileNumber\":\"18002585970\",\"IntermediaryName\":\"POLICYBAZAARINSURANCEBROKERSPRIVATELIMITED\",\"LeadId\":null,\"MandateEndDate\":null,\"MandateStartDate\":null,\"MasterPolicy\":null,\"MasterPolicyNumber\":\"ABC-71-21-00036-01-02\",\"MaturityDate\":\"2025-07-28\",\"Mode\":\"OnlinePayment\",\"NameOfEW\":null,\"NetPremium\":\"4650.0\",\"NextPremiumDate\":\"2025-07-29\",\"OwnerClientCode\":\"13882784-01\",\"PaymentStatus\":\"Raisedandpaid\",\"PlanName\":\"GroupActivHealthv2\",\"PolicyCancellationReason\":null,\"PolicyIssueDate\":\"2024-07-29\",\"PolicyNumber\":\"GHI-HB-22-2007426-007-01\",\"PolicyStatus\":\"IF\",\"PolicySubStatus\":null,\"PolicyTerm\":\"1Year\",\"PolicyType\":\"Affinity\",\"PolicySubType\":\"Certificate\",\"PortalCertificate\":null,\"ProductName\":\"GroupActivHealthV2\",\"ProposalType\":\"STP\",\"RejectionReason\":null,\"SNCB\":null,\"SalesManagerEmail\":null,\"SalesManagerMobile\":\"9899937413\",\"SalesRelationshipManagerCode\":\"417457\",\"SalesRelationshipManagerName\":\"NaveenSehrawat\",\"SandboxPolicy\":\"No\",\"ServicingBranchName\":\"HeadOffice\",\"Source\":\"TCSBaNCS\",\"TAXDetails\":\"837.0\",\"TPA\":null,\"TPAContactDetails\":null,\"TotalSumInsured\":\"9500000\",\"UR\":null,\"UWLoading\":\"0\",\"ZoneOfCover\":\"ZoneIII\",\"TotalHR\":null,\"UtilizedHR\":null,\"SponsoredFlag\":\"No\",\"RenewableFlag\":\"YES\",\"PreviousPolicyNumber\":null}}';
        String response = createRequest(retailPolicy);

        Test.stopTest();
        ABHI_ResponseWrapper responseBody = (ABHI_ResponseWrapper) JSON.deserialize(response.toString(), ABHI_ResponseWrapper.class);
        Assert.areEqual('100', responseBody.StatusCode);
        Assert.areEqual('Failure', responseBody.StatusMessage);

    }
    
    /****************************************************************************************************
    * @Function - createRequest
    * @param body - String body to be used
    * description  - Method to create rest request for the test methods
    *****************************************************************************************************/
    private static String createRequest(String body){
        RestRequest req = new RestRequest(); 
        RestResponse res = new RestResponse();
        req.requestURI = '/services/apexrest/CreateCRMPolicy';
        req.requestBody = Blob.valueof(body);
        req.httpMethod = 'POST';
        RestContext.request = req;
        RestContext.response= res;
        return ABHI_CreateCRMPolicy.createCRMPolicy();
    }
}